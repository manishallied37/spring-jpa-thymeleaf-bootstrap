<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>

	<!-- Google Font: Source Sans Pro -->
	<link rel="stylesheet"
		th:href="@{https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback}">
	<!-- Font Awesome Icons -->
	<link rel="stylesheet" th:href="@{plugins/fontawesome-free/css/all.min.css}">
	<!-- overlayScrollbars -->
	<link rel="stylesheet" th:href="@{plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">
	<!-- Theme style -->
	<link rel="stylesheet" th:href="@{dist/css/adminlte.min.css}">
	<!-- IonIcons -->
	<link rel="stylesheet" th:href="@{https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css}">
	<!-- overlayScrollbars -->
	<link rel="stylesheet" th:href="@{plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">
	<!-- Select2 -->
	<link rel="stylesheet" th:href="@{plugins/select2/css/select2.min.css}">
	<!-- Bootstrap4 -->
	<link rel="stylesheet" th:href="@{plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css}">
	<!-- Bootstrap4 Duallistbox -->
	<link rel="stylesheet" th:href="@{plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css}">
	<!-- BS Stepper -->
	<link rel="stylesheet" th:href="@{plugins/bs-stepper/css/bs-stepper.min.css}">
	<!-- dropzonejs -->
	<link rel="stylesheet" th:href="@{plugins/dropzone/min/dropzone.min.css}">
	<!-- Toastr -->
	<link rel="stylesheet" th:href="@{plugins/toastr/toastr.min.css}">
	<!-- Swagger -->
	<link rel="stylesheet" type="text/css" href="/swagger-editor/swagger-ui.css">


	<style>
		#load {
			position: fixed;
			left: 0px;
			top: 0px;
			width: 100%;
			height: 100%;
			z-index: 9999;
			background: url(images/loader.gif) center no-repeat #fff;
			opacity: 1;

		}
		.nav-sidebar .nav-treeview > .nav-item > .nav-link {
		    background-color: transparent !important;
		    color: #777 !important;
		}

		.topbar {
			display: none;
		}
	</style>

</head>

<body class="hold-transition  sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">

	<div id="load"></div>

	<!-- HOME SECTION -->
	<div class="wrapper">


		<!-- Navbar -->
		<nav class="main-header navbar navbar-expand navbar-light" style="background:rgb(255, 255, 255);">
			<!-- Left navbar links -->
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
				</li>

			</ul>

			<!-- Right navbar links -->
			<ul class="navbar-nav ml-auto">

				<li class="nav-item">
					<a class="nav-link" data-widget="fullscreen" href="#" role="button">
						<i class="fas fa-expand-arrows-alt"></i>
					</a>
				</li>

			</ul>
		</nav>
		<!-- /.navbar -->

		<!-- Main Sidebar Container -->
		<aside class="main-sidebar sidebar-light-primary elevation-4">
			<!-- Brand Logo -->
			<a href="#" class="brand-link">
				<img th:src="@{images/2.jpg}" id="navbar-logo" alt="" class="brand-image  " style="width: 210px;">
				<!--<span class="brand-text font-weight-dark ">ALLIED GLOBETECH</span>-->
			</a>

			<!-- Sidebar -->
			<div class="sidebar">



				<!-- Sidebar Menu -->
				<nav class="mt-2">

					<ul class="nav nav-pills nav-sidebar nav-child-indent flex-column text-white rolelist"
					    data-widget="treeview" role="menu" data-accordion="false">
					
						<li class="nav-item text-bold"
						    th:each="menu : ${navMenus}"
						    th:classappend="
						        ${menu.children.size() > 0} ? 'has-treeview' : ''
						    ">

							<a class="nav-link"
							   th:href="${menu.children.size() > 0} ? '#' : @{${menu.route}}">
				
				                <i class="nav-icon text-navy"
				                   th:classappend="${menu.icon}"></i>
				
				                <p>
				                    <i class="fas fa-angle-right right"
				                       th:if="${menu.children.size() > 0}"></i>
				                    <th:block th:text="${menu.title}"></th:block>
				                </p>
				            </a>
				
				            <ul class="nav nav-treeview"
							    th:if="${menu.children.size() > 0}"
							    th:insert="fragments/sidebar-menu :: childMenu(${menu.children})">
							</ul>
				
				        </li>
					</ul>

				</nav>
				<!-- /.sidebar-menu -->
			</div>
			<!-- /.sidebar -->
		</aside>
		
		<div class="content-wrapper">

			  <!-- Header -->
			  <section class="content-header">
			    <div class="container-fluid">
			      <div class="row mb-2">
			        <div class="col-sm-6">
			          <h1>API Cart Billing</h1>
			        </div>
			        <div class="col-sm-6">
			          <ol class="breadcrumb float-sm-right" id="dynamicBreadcrumb"></ol>
			        </div>
			      </div>
			    </div>
			  </section>
			
			  <!-- Main content -->
			  <section class="content">
			    <div class="container-fluid">
			
			      <div class="card">
			        <div class="card-body">
			
			          <div class="table-responsive">
  						<table class="table table-bordered table-hover" id="cartTable">
    						<thead class="thead-light">
      							<tr>
        							<th>API Name</th>
        							<th>Category</th>
        							<th>Status</th>
        							<th>Price</th>
      								</tr>
    						</thead>
    						<tbody></tbody>
    						<tfoot>
      							<tr>
        							<th colspan="3" class="text-right">Subtotal</th>
        							<th id="cartSubtotal">â‚¹0</th>
      							</tr>
      							<tr>
        							<th colspan="3" class="text-right">Tax (0%)</th>
        							<th>â‚¹0</th>
      							</tr>
      							<tr class="table-success">
        							<th colspan="3" class="text-right">Total Payable</th>
        							<th id="cartTotal"><strong>â‚¹0</strong></th>
      							</tr>
    						</tfoot>
  						</table>
					</div>
			
			          <div class="mt-3 text-right">
			            <button class="btn btn-success" id="checkoutBtn">
			              Confirm & Pay
			            </button>
			          </div>
			
			        </div>
			      </div>
			
			    </div>
			  </section>
			
			</div>

		<!-- /.content-wrapper -->


		<!-- Main Footer -->
		<footer class="main-footer">
			<div>
				<div>
					<footer class="main-footer">
						<div class="col-md-4" style="float:left;"> Â© 2021-2026 All rights reserved.</div>
						<div class="col-md-4" style="float:left;text-align:center;"> <img class="img-fluid"
								th:src="@{/images/flag.png}" alt="Proudly Made In India" width="50" height="40">
							&nbsp; Proudly Made In India</div>
						<div class="float-right d-none d-sm-inline-block">
							<!--<img class="img-fluid" th:src="@{/images/alliedlogo.jpeg}"  alt="Photo" width="60" height="60"> -->Designed
							& Developed by <img class="img-fluid" width="100" height="100"
								th:src="@{/images/AlliedGlobetech.png}" alt="Allied GlobeTech">
						</div>
					</footer>
				</div>
			</div>

		</footer>
	</div>
	
	<!--REQUIRED SCRIPTS-->
	<!-- jQuery -->
	<script th:src="@{plugins/jquery/jquery.min.js}"></script>
	<!-- Bootstrap -->
	<script th:src="@{plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<!-- overlayScrollbars -->
	<script th:src="@{plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
	<!-- AdminLTE App -->
	<script th:src="@{static/dist/js/adminlte.js}"></script>
	<!-- Bootstrap Switch -->
	<script th:src="@{plugins/bootstrap-switch/js/bootstrap-switch.min.js}"></script>
	<!-- BS-Stepper -->
	<script th:src="@{plugins/bs-stepper/js/bs-stepper.min.js}"></script>
	<!-- dropzonejs -->
	<script th:src="@{plugins/dropzone/min/dropzone.min.js}"></script>
	<!-- AdminLTE App -->
	<script th:src="@{dist/js/adminlte.min.js}"></script>
	<!-- AdminLTE for demo purposes -->
	<script th:src="@{dist/js/demo.js}"></script>

	<!-- PAGE PLUGINS -->
	<!-- jQuery Mapael -->
	<script th:src="@{plugins/jquery-mousewheel/jquery.mousewheel.js}"></script>
	<script th:src="@{plugins/raphael/raphael.min.js}"></script>
	<script th:src="@{plugins/jquery-mapael/jquery.mapael.min.js}"></script>
	<script th:src="@{plugins/jquery-mapael/maps/usa_states.min.js}"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

	<!-- Developer Script -->
	<script th:src="@{dist/js/Common.js}"></script>
	
	<script th:inline="javascript">
	    const NAV_MENUS = /*[[${navMenus}]]*/ [];
	    const CURRENT_ROUTE = /*[[${#httpServletRequest.requestURI}]]*/ '';
	</script>
	
	<script th:src="@{/swagger-editor/js-yaml-min.js}"></script>
	<script th:src="@{/swagger-editor/swagger-ui-bundle.js}"></script>
	<script th:src="@{/swagger-editor/swagger-ui-standalone-preset.js}"></script>
	
	<script th:src="@{dist/js/SecurityEncryption.js}"></script>
	
	<!--API CART PRICING-->
	<script src="/dist/js/pricing.js"></script>
	
	<script>
const CART_KEY = "API_CART";

function getCart() {
    const cart = localStorage.getItem(CART_KEY);
    return cart ? JSON.parse(cart) : [];
}

function renderBreadcrumb() {
    const breadcrumb = document.getElementById("dynamicBreadcrumb");
    breadcrumb.innerHTML = `
      <li class="breadcrumb-item">
        <a href="/apicart">
          <i class="fas fa-arrow-left mr-1"></i> Go back to Cart
        </a>
      </li>
      <li class="breadcrumb-item active">Billing</li>
    `;
}

function renderBillingPage() {
    const cart = getCart();
    const apiNames = cart.map(api => api.id);

    const tbody = document.querySelector("#cartTable tbody");
    const subtotalEl = document.getElementById("cartSubtotal");
    const totalEl = document.getElementById("cartTotal");
    const payBtn = document.getElementById("checkoutBtn");

    tbody.innerHTML = "";
    subtotalEl.innerText = "â‚¹0";
    totalEl.innerText = "â‚¹0";

    if (cart.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="text-center text-muted">
              No APIs in cart
            </td>
          </tr>`;
        payBtn.disabled = true;
        return;
    }

    // ðŸ”¥ ONLY place pricing is applied
   const query = apiNames
    .map(name => `apiNames=${encodeURIComponent(name)}`)
    .join("&");

console.log("API names sent to backend:", apiNames);

fetch(`/api/pricing?${query}`)
    .then(res => res.json())
    .then(priceMap => {
        let total = 0;
        tbody.innerHTML = "";

        cart.forEach(api => {
            const price = priceMap[api.id] || 0;
            total += price;

            tbody.innerHTML += `
              <tr>
                <td>${api.name}</td>
                <td>${api.category}</td>
                <td><span class="badge badge-warning">Pending</span></td>
                <td>â‚¹${price}</td>
              </tr>`;
        });

        subtotalEl.innerText = `â‚¹${total}`;
        totalEl.innerText = `â‚¹${total}`;
        payBtn.disabled = false;
    })
    .catch(err => {
        console.error("Pricing fetch failed", err);
        payBtn.disabled = true;
    });
}

renderBillingPage();
renderBreadcrumb();
</script>


	