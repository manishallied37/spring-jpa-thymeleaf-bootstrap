<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Swagger Editor</title>
    <link href="./swagger-editor.css" rel="stylesheet" type="text/css"/>
    <link href="./favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
    <link href="./favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
    <style>

        .Pane.vertical.Pane1{
        display:none;
        }
        .Pane.vertical.Pane2{
        width:100% !important;
        overflow-x: auto !important;
        }
          html {
            box-sizing: border-box;
            overflow: -moz-scrollbars-vertical;
            overflow-y: scroll;
          }
          *, *:before, *:after {
            box-sizing: inherit;
          }
          body {
            margin: 0;
            background: #fafafa;
          }
    </style>
</head>

<body>
<div id="swagger-editor"></div>

<script src="./swagger-editor-bundle.js"></script>
<script src="./swagger-editor-standalone-preset.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>
<script src="./swagger-editor.js"></script>
<script>
    window.onload = function () {

	  fetch("/swagger-json")
	    .then(res => res.text())
	    .then(data => {
	
	      let spec = null;
	      let isWadl = false;
	
	      try {
	        spec = JSON.parse(data);
	      } catch (e) {}
	
	      if (!spec) {
	        try {
	          spec = jsyaml.load(data);
	        } catch (e) {}
	      }
	
	      if (!spec && data.trim().startsWith("<")) {
	        isWadl = true;
	      }
	
	      if (isWadl) {
	        document.getElementById("swagger-editor").innerHTML =
	          "<h3>WADL detected</h3>" +
	          "<p>Swagger Editor does not support WADL.</p>" +
	          "<pre style='white-space: pre-wrap;'>" +
	          escapeHtml(data) +
	          "</pre>";
	        return;
	      }
	
	      SwaggerEditorBundle({
	        dom_id: "#swagger-editor",
	        presets: [
	          SwaggerEditorStandalonePreset
	        ],
	        layout: "EditorLayout",
	        spec: spec
	      });
	    })
	    .catch(err => {
	      document.getElementById("swagger-editor").innerHTML =
	        "<h2>Error loading spec</h2><pre>" + err + "</pre>";
	    });
	};
	
	function escapeHtml(str) {
	  return str
	    .replace(/&/g, "&amp;")
	    .replace(/</g, "&lt;")
	    .replace(/>/g, "&gt;");
	}
</script>
</body>
</html>
